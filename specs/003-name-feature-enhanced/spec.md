# Feature Spec: Enhanced Testing and Validation Reporting

## 1. Overview

**Goal:** Enhance the project's testing framework by expanding integration test coverage and centralizing backtest validation results into a database with a visual dashboard for historical analysis.

**Current Problem:**
1.  **Limited Integration Testing:** The validation reports show that specific integration tests for strategies and components are often missing. This creates a gap where unit tests may pass, but the interaction between components could fail.
2.  **Ephemeral Validation Results:** Backtest validation results are stored as individual text files in `tests/validation_results/`. This format makes it difficult to track a strategy's performance over time, compare results from different parameter sets, or get a high-level view of all strategies' health.

**Proposed Solution:**
1.  **Implement Integration Tests:** Create a dedicated test suite for integration tests that verifies the end-to-end functionality of key components, such as the data pipeline and the signal-to-trade workflow.
2.  **Centralize Validation Reports:** Modify the validation script to write key performance metrics to a database. Create a simple Streamlit dashboard to query this database and visualize historical performance trends.

## 2. Functional Requirements

### 2.1. Integration Test Suite

- A new directory, `tests/test_integration/`, will be created.
- New test files will be added to cover key interaction points:
    - `test_data_pipeline.py`: Will test the entire data flow from data collection (`collectors.py`) to storage (`storage.py`) and loading (`loaders.py`).
    - `test_signal_to_trade_workflow.py`: Will test the workflow from a signal being generated by `proratio_signals` to a trade being managed by `proratio_tradehub`.

### 2.2. Database for Validation Results

- A new SQL schema will be defined (e.g., in `proratio_utilities/data/schema.sql`) for a table named `validation_results`.
- The table will include columns for:
    - `id` (Primary Key)
    - `strategy_name` (TEXT)
    - `timestamp` (TIMESTAMP)
    - `total_trades` (INTEGER)
    - `win_rate` (FLOAT)
    - `total_profit_pct` (FLOAT)
    - `max_drawdown` (FLOAT)
    - `sharpe_ratio` (FLOAT)
    - `profit_factor` (FLOAT)
    - `git_commit_hash` (TEXT, optional)
- The `scripts/validate_backtest_results.py` script will be modified to connect to the database (using connection details from Pydantic `Settings`) and insert a new row with the metrics from the completed backtest.

### 2.3. Historical Performance Dashboard

- A new Streamlit application will be created at `proratio_tradehub/dashboard/validation_dashboard.py`.
- This dashboard will:
    - Connect to the `validation_results` database table.
    - Allow users to select a strategy from a dropdown menu.
    - Display time-series charts for the selected strategy's key metrics (e.g., a line chart of `total_profit_pct` over time).
    - Show a summary table of the latest validation run for all strategies.
- A new script, `scripts/start_validation_dashboard.sh`, will be added to launch the Streamlit app.

## 3. Non-Functional Requirements

- **Performance:** The database writing operation should be efficient and not significantly slow down the validation script.
- **Usability:** The dashboard should be intuitive, providing clear and actionable insights into strategy performance over time.
- **Data Integrity:** The database schema should enforce appropriate data types to ensure the quality of the stored metrics.

## 4. Out of Scope

- This feature does **not** include building a real-time or live trading monitoring dashboard. The focus is strictly on historical backtest results.
- The initial dashboard will be for visualization only and will not include features for triggering new backtests or modifying strategy parameters.
